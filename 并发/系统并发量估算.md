---
title: 系统并发量估算
date: 2017-03-25 17:44:44
categories:
- 并发
tags:
- 并发
---

# 系统并发量估算

#### 系统并发量描述术语

###### 响应时间(RT) 
- 响应时间是指系统对请求作出响应的时间。

###### 吞吐量(Throughput)
- 吞吐量是指系统在单位时间内处理请求的数量。

###### 并发用户数
- 并发用户数是指系统可以同时承载的正常使用系统功能的用户的数量。

###### 每秒查询率QPS(Queries Per Second)
- 是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。

###### 每秒事务数TPS(Transactions Per Second)
- 是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。

#### 服务器端最佳线程数量估算

- 公式 服务器端最佳线程数量=((线程等待时间+线程cpu时间)/线程cpu时间) * cpu数量

###### 影响最佳线程数因素

- IO  IO操作会造成现场阻塞，拥有较多IO操作的服务需要较多的线程来提高cpu的利用率，但是较多的线程会造成线程直接频繁切换的开销。
- CPU 纯CPU运算的服务器最优线程为cpu数量，一般来说设置N+1（例如Netty的工作线程组默认大小就是N+1）。CPU是一台服务器吞吐量的上限。

###### JVM中最佳线程数

- 频繁的FULL GC会极大影响系统并发量。

###### 设置线程池数量

- 压测最佳线程数<真实设置的线程数量<内存极限线程数，实际中IO响应时间可能会变长，所以真实线程应稍大于压测获得的最佳线程以充分利用CPU性能。




