---
title: 支付网关系统优化
date: 2018-01-13 13:08:22
categories: 
- 支付
tags:
- 支付
- java
---

# 支付网关系统优化

## 系统现状

```
|-------------|
|   负载均衡   |
|-------------|

|------|
| 应用  |
|------|

```

#### 系统并发瓶颈

- ServerSocket单线程接收数据 -》 netty
- http调用第三方服务操作 -》改为异步http工具
- 日志同步IO操作 -》 改为log4j异步日志
- 轮询情况下sleep阻塞线程 -》改为协程，异步，或通知回调等方式轮询
- 数据库JDBC同步IO操作 -》暂不改动，考虑目前数据库响应速度较快

## 并发优化

#### 高并发方案

##### Reactor异步方案

###### Vert.X + RxJava

###### spring-boot 2 reactive + ProjectReactive

##### 协程方案

###### netty + quasar携程库

## 网关系统2.0方案

- 因决定要实现POS机的一机一密，系统会有大改动，趁此机会，可以重构网关系统的2.0版本

#### 需求

- 高并发，高可靠性
- 保证之前版本的兼容性
- 最好http与tcp接口，保持相同的项目。

#### 方案

##### 方案一

- 一个tcp网关，解析8583报文，老版本直接透明转发（如果签名方式变化，可能需要重签名），新版本解析报文后并进行一些验证处理后，请求后端rest服务，轮询，关单等逻辑在网关实现。
- 一个http网关，进行验签，转发等操作。
- 后端采用微服务等模式，提供restful接口。
- 数据库维持不变

##### 方案二

- 