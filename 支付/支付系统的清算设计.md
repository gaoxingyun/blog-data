---
title: 支付系统的清算设计
date: 2017-12-15 20:42:12
categories: 
- 支付
tags:
- 支付
- java
---


#

#### 入金
- 备付金入金金额是渠道方应清算给平台的钱，一般T+1入账，渠道会提供渠道方的对账单
当日对账金额：
入账金额 = 交易金额 - 渠道成本

- 渠道对账单 渠道账单日发生的交易
- 平台账单 平台账单日发生的交易

- 当日对账平，即渠道对账单及平台账单一致的订单。
```
当日对账平				
交易总笔数	交易总金额	商户手续费	总实际成本	优惠金额
```
- 当日延时平，即前一天的渠道没有的交易今日有
```
当日平延迟				
交易总笔数	交易总金额	商户手续费	总实际成本	优惠金额
```
- 长交易，平台有而渠道没有的交易订单， 可知长交易无法获得渠道成本
```
长交易		
交易总笔数	交易总金额	商户手续费
```

- 短交易，渠道方有而平台没有的交易订单，可知短交易无法获得商户手续费
```
短交易		
交易总笔数	交易总金额	总实际成本
```

当日应入款金额 = 当日对账平订单金额 - 当日对账平订单成本 + 当日延时平订单 - 当日延时平订单成本 + 短交易订单金额 - 短交易订单成本

#### 出金

- 出金是每日平台清算给商户的资金

- 全额手续费是需通过外部扣除的商户手续费
- s0划款金额是账单日已经划款的金额

```
消费金额 手续费(商户) 全额手续费 s0划款金额 冻结金额 解冻金额
```

- 当日应出账金额 = 消费金额 - 商户手续费

- 实际应收手续费 = 商户手续费 - 外部扣除手续费（全额手续费）

- 前日已划款金额 = s0划款金额

- 当日可划款金额 = 当日应出账金额 + 外部收取手续费 - 前日已划款金额 - 冻结金额 + 解冻金额


